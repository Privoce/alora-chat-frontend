{"ast":null,"code":"import _regeneratorRuntime from \"/home/tulio/Documentos/projetosJs/privoce/react-socketio-nodejs-chatapp/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/tulio/Documentos/projetosJs/privoce/react-socketio-nodejs-chatapp/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { fetch } from 'whatwg-fetch';\nimport { toast } from 'react-toastify';\nimport Cookies from 'js-cookie';\nimport constants from 'modules/constants';\nimport queryString from 'querystring';\nimport history from 'react-router/history';\nimport store from 'redux/store';\nimport _ from 'lodash';\nimport moment from 'moment';\nimport * as socketActions from 'redux/actions/socket';\nimport * as mainActions from 'redux/actions/main';\nexport function isDevelopmentEnv() {\n  return process.env.NODE_ENV.toLowerCase() === 'development';\n}\nexport function setCookie(key, value, expires) {\n  return Cookies.set(key, value, {\n    expires: expires\n  });\n}\nexport function removeCookie(key) {\n  return Cookies.remove(key);\n}\nexport function getCookieJson(key) {\n  return Cookies.getJSON(key);\n}\nexport function getCookie(key) {\n  return Cookies.get(key);\n}\nexport function setToken(value) {\n  return setCookie(constants.GLOBAL.TOKEN_COOKIE_KEY, value, constants.GLOBAL.TOKEN_COOKIE_EXPIRES);\n}\nexport function setUser(value) {\n  return setCookie(constants.GLOBAL.USER_COOKIE_KEY, value, constants.GLOBAL.USER_COOKIE_EXPIRES);\n}\nexport function getToken() {\n  return getCookieJson(constants.GLOBAL.TOKEN_COOKIE_KEY);\n}\nexport function getUser() {\n  return getCookieJson(constants.GLOBAL.USER_COOKIE_KEY);\n}\nexport function removeToken() {\n  return removeCookie(constants.GLOBAL.TOKEN_COOKIE_KEY);\n}\nexport function removeUser() {\n  return removeCookie(constants.GLOBAL.USER_COOKIE_KEY);\n}\nexport function createAcronym(param) {\n  return (param || '').toUpperCase().slice(0, 2);\n}\nexport function resetRedux() {\n  var dispatch = store.dispatch;\n  dispatch(mainActions.reset());\n}\nexport function logout() {\n  return _logout.apply(this, arguments);\n}\n\nfunction _logout() {\n  _logout = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee() {\n    var dispatch, stopChannel;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            dispatch = store.dispatch;\n            stopChannel = socketActions.stopChannel;\n            dispatch(stopChannel());\n            removeToken();\n            removeUser();\n            resetRedux();\n            history.push('/signin');\n\n          case 7:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, this);\n  }));\n  return _logout.apply(this, arguments);\n}\n\nexport function login(_x, _x2) {\n  return _login.apply(this, arguments);\n}\n\nfunction _login() {\n  _login = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee2(token, user) {\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return setToken(token);\n\n          case 2:\n            _context2.next = 4;\n            return setUser(user);\n\n          case 4:\n            _context2.next = 6;\n            return resetRedux();\n\n          case 6:\n            _context2.next = 8;\n            return history.push('/');\n\n          case 8:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2, this);\n  }));\n  return _login.apply(this, arguments);\n}\n\nexport function sendRequest(_x3) {\n  return _sendRequest.apply(this, arguments);\n}\n\nfunction _sendRequest() {\n  _sendRequest = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee3(_ref) {\n    var url, method, body, query, token, fetchParams, result;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            url = _ref.url, method = _ref.method, body = _ref.body, query = _ref.query;\n            token = getToken();\n            fetchParams = {\n              method: method,\n              headers: {\n                'Content-Type': 'application/json',\n                'x-access-token': token\n              },\n              body: body\n            };\n\n            if (body) {\n              fetchParams.body = JSON.stringify(body);\n            }\n\n            _context3.next = 6;\n            return fetch(query ? \"\".concat(url, \"?\").concat(queryString.stringify(query)) : url, fetchParams);\n\n          case 6:\n            result = _context3.sent;\n            _context3.t0 = result.status;\n            _context3.next = _context3.t0 === 401 ? 10 : _context3.t0 === 500 ? 12 : 14;\n            break;\n\n          case 10:\n            logout();\n            return _context3.abrupt(\"break\", 15);\n\n          case 12:\n            toast.error(constants.LABELS.MAIN.GLOBAL_ERROR);\n            return _context3.abrupt(\"break\", 15);\n\n          case 14:\n            return _context3.abrupt(\"break\", 15);\n\n          case 15:\n            return _context3.abrupt(\"return\", result.json());\n\n          case 16:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3, this);\n  }));\n  return _sendRequest.apply(this, arguments);\n}\n\nexport function searchParam(array, params) {\n  var result = array;\n\n  _.mapKeys(params, function (value, key) {\n    if (value) {\n      result = _.filter(array, function (model) {\n        return _.includes(model[key], value.toLowerCase());\n      });\n    }\n  });\n\n  return result;\n}\nexport function setConversationLastMessageDateTime(date) {\n  var diffHours = moment(new Date()).diff(moment(date), 'hour');\n  var diffDays = moment(new Date()).startOf('day').diff(moment(date).startOf('day'), 'day');\n\n  if (diffHours <= 0) {\n    return moment(date).fromNow(true);\n  }\n\n  if (diffDays <= 0) {\n    return moment(date).format('HH:mm');\n  }\n\n  if (diffDays <= 6) {\n    if (diffDays === 1) {\n      return 'yesterday';\n    }\n\n    return moment(date).format('dddd');\n  }\n\n  return moment(date).format('DD/MM/YYYY');\n}","map":{"version":3,"sources":["/home/tulio/Documentos/projetosJs/privoce/react-socketio-nodejs-chatapp/client/src/modules/utils/index.js"],"names":["fetch","toast","Cookies","constants","queryString","history","store","_","moment","socketActions","mainActions","isDevelopmentEnv","process","env","NODE_ENV","toLowerCase","setCookie","key","value","expires","set","removeCookie","remove","getCookieJson","getJSON","getCookie","get","setToken","GLOBAL","TOKEN_COOKIE_KEY","TOKEN_COOKIE_EXPIRES","setUser","USER_COOKIE_KEY","USER_COOKIE_EXPIRES","getToken","getUser","removeToken","removeUser","createAcronym","param","toUpperCase","slice","resetRedux","dispatch","reset","logout","stopChannel","push","login","token","user","sendRequest","url","method","body","query","fetchParams","headers","JSON","stringify","result","status","error","LABELS","MAIN","GLOBAL_ERROR","json","searchParam","array","params","mapKeys","filter","model","includes","setConversationLastMessageDateTime","date","diffHours","Date","diff","diffDays","startOf","fromNow","format"],"mappings":"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","sourcesContent":["import {\n\tfetch\n} from 'whatwg-fetch';\n\nimport {\n\ttoast\n} from 'react-toastify';\n\nimport Cookies from 'js-cookie';\nimport constants from 'modules/constants';\nimport queryString from 'querystring';\nimport history from 'react-router/history';\nimport store from 'redux/store';\nimport _ from 'lodash';\nimport moment from 'moment';\nimport * as socketActions from 'redux/actions/socket';\nimport * as mainActions from 'redux/actions/main';\n\nexport function isDevelopmentEnv () {\n\treturn process.env.NODE_ENV.toLowerCase() === 'development';\n}\n\nexport function setCookie (key, value, expires) {\n\treturn Cookies.set(key, value, { expires });\n}\n\nexport function removeCookie (key) {\n\treturn Cookies.remove(key);\n}\n\nexport function getCookieJson (key) {\n\treturn Cookies.getJSON(key);\n}\n\nexport function getCookie (key) {\n\treturn Cookies.get(key);\n}\n\nexport function setToken (value) {\n\treturn setCookie(constants.GLOBAL.TOKEN_COOKIE_KEY, value, constants.GLOBAL.TOKEN_COOKIE_EXPIRES);\n}\n\nexport function setUser (value) {\n\treturn setCookie(constants.GLOBAL.USER_COOKIE_KEY, value, constants.GLOBAL.USER_COOKIE_EXPIRES);\n}\n\nexport function getToken () {\n\treturn getCookieJson(constants.GLOBAL.TOKEN_COOKIE_KEY);\n}\n\nexport function getUser () {\n\treturn getCookieJson(constants.GLOBAL.USER_COOKIE_KEY);\n}\n\nexport function removeToken () {\n\treturn removeCookie(constants.GLOBAL.TOKEN_COOKIE_KEY);\n}\n\nexport function removeUser () {\n\treturn removeCookie(constants.GLOBAL.USER_COOKIE_KEY);\n}\n\nexport function createAcronym (param) {\n\treturn (param || '').toUpperCase().slice(0, 2);\n}\n\nexport function resetRedux () {\n\tconst {\n\t\tdispatch\n\t} = store;\n\n\tdispatch(mainActions.reset());\n}\n\nexport async function logout () {\n\tconst {\n\t\tdispatch\n\t} = store;\n\n\tconst {\n\t\tstopChannel\n\t} = socketActions;\n\n\tdispatch(stopChannel());\n\tremoveToken();\n\tremoveUser();\n\tresetRedux();\n\thistory.push('/signin');\n}\n\nexport async function login (token, user) {\n\tawait setToken(token);\n\tawait setUser(user);\n\tawait resetRedux();\n\tawait history.push('/');\n}\n\nexport async function sendRequest ({\n\turl,\n\tmethod,\n\tbody,\n\tquery\n}) {\n\tconst token = getToken();\n\tconst fetchParams = {\n\t\tmethod,\n\t\theaders: {\n\t\t\t'Content-Type': 'application/json',\n\t\t\t'x-access-token': token\n\t\t},\n\t\tbody\n\t};\n\n\tif (body) {\n\t\tfetchParams.body = JSON.stringify(body);\n\t}\n\n\tconst result = await fetch(query ? `${url}?${queryString.stringify(query)}` : url, fetchParams);\n\n\tswitch (result.status) {\n\t\tcase 401:\n\t\t\tlogout();\n\t\t\tbreak;\n\n\t\tcase 500:\n\t\t\ttoast.error(constants.LABELS.MAIN.GLOBAL_ERROR);\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\n\treturn result.json();\n}\n\nexport function searchParam (array, params) {\n\tlet result = array;\n\n\t_.mapKeys(params, (value, key) => {\n\t\tif (value) {\n\t\t\tresult = _.filter(array, (model) => {\n\t\t\t\treturn _.includes(model[key], value.toLowerCase());\n\t\t\t});\n\t\t}\n\t});\n\n\treturn result;\n}\n\nexport function setConversationLastMessageDateTime (date) {\n\tconst diffHours = moment(new Date()).diff(moment(date), 'hour');\n\tconst diffDays = moment(new Date()).startOf('day').diff(moment(date).startOf('day'), 'day');\n\n\tif (diffHours <= 0) {\n\t\treturn moment(date).fromNow(true);\n\t}\n\n\tif (diffDays <= 0) {\n\t\treturn moment(date).format('HH:mm');\n\t}\n\n\tif (diffDays <= 6) {\n\t\tif (diffDays === 1) {\n\t\t\treturn 'yesterday';\n\t\t}\n\n\t\treturn moment(date).format('dddd');\n\t}\n\n\treturn moment(date).format('DD/MM/YYYY');\n}\n"]},"metadata":{},"sourceType":"module"}